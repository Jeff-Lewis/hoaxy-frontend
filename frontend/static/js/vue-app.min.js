var max_articles=20,defaultProfileImage="static/assets/Twitter_logo_blue_32-cropped.png",defaultHoaxyLang="en",papa_parse_config={delimiter:"",newline:"",quoteChar:'"',escapeChar:'"',header:!0,transformHeader:void 0,dynamicTyping:!1,preview:0,encoding:"",worker:!1,comments:!1,step:void 0,complete:void 0,error:void 0,download:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,transform:void 0,delimitersToGuess:[",","\t","|",";",Papa.RECORD_SEP,Papa.UNIT_SEP]},papa_unparse_config={quotes:!1,quoteChar:'"',escapeChar:'"',delimiter:",",header:!0,newline:"\r\n",skipEmptyLines:!1,columns:null},TWEET_URL="https://twitter.com/%0/status/%1",debug=!1,colors={node_colors:{fact_checking:"darkblue",claim:"darkblue",botscores:[{red:215,green:25,blue:28},{red:253,green:174,blue:97},{red:255,green:255,blue:191},{red:171,green:221,blue:164},{red:62,green:182,blue:229}]},edge_colors:{fact_checking:"rgb(238,210,2)",fact_checking_dark:"rgb(169, 171, 2)",claim:"darkgray",claim_dark:"gray"}},app=new Vue({el:"#vue-app",data:function(){return{import_or_search:"search",ready_to_visualize:!1,imported_file_type:"",imported_data:null,loading:!0,mounted:!1,show_articles:!1,show_full_articles_list:!1,show_graphs:!1,show_zoom_buttons:!1,graph_column_size:3,info_text:"",articles:[],articles_to_show:max_articles,search_disabled:!0,input_disabled:!1,spin_key_table:["initialLoad"],spinner_state:1,spinner_rotate:0,spin_timer:0,spinner_notices:{graph:"",timeline:"",articles:""},query_text:"",searched_query_text:"",query_sort:"relevant",query_include_mentions:!0,checked_articles:[],profile:{name:"",image:defaultProfileImage},twitter_account_info:{},twitter:{},twitter_result_type:"mixed",globalHoaxyTimeline:null,globalTwitterSearchTimeline:null,timeline:null,graph:null,getting_bot_scores:{running:!1},copiedWidgetText:!1,widgetScreenshotDataUrl:"",showWidgetModal:!1,show_error_modal:!1,error_message:"",show_authenticate_modal:!1,show_edge_modal:!1,show_node_modal:!1,show_tutorial_link:!0,show_tutorial_modal:!1,modal_opacity:!1,edge_modal_content:{edge:{},tweet_urls:{},label_string:""},node_modal_content:{staleAcctInfo:{isStale:!1,newId:"",oldSn:"",newSn:""},showStaleContent:!0,user_id:"",screenname:"",has_quoted:[],has_mentioned:[],has_retweeted:[],is_quoted_by:[],is_mentioned_by:[],is_retweeted_by:[],has_quoted_count:0,has_mentioned_count:0,has_retweeted_count:0,is_quoted_by_count:0,is_mentioned_by_count:0,is_retweeted_by_count:0,completeAutomationProbability:0,botscore:0,botcolor:0},failed_to_get_network:!1,graphAnimation:{playing:!1,increment:0,total_increments:240,current_timestamp:0,paused:!1},feedback_form:{display:!1,comment:"",type:"",type_choices:{Human:"human",Bot:"bot","Cyborg (human using e.g. a scheduler)":"cyborg",Organization:"organization"}},source_dropdown_open:!1,colors:colors,searchBy:"Hoaxy",searchedBy:"",searchPlaceholder:"Example: vaccines",hoaxySearchSelected:!0,twitterSearchSelected:!1,lang:defaultHoaxyLang,twitterEdges:[],hoaxyEdges:[],twitterTimeline:{claim:{timestamp:[],volume:[]},fact_checking:{timestamp:[],volume:[]}},animationAvailable:!0,twitterUserSet:new Set,twitterDates:[],popular_articles:{claim:[],fact_checking:[]},top_claim_articles:[],top_fact_checking_articles:[],top_usa_articles:[],twitterRateLimitReachedObj:{isReached:!1},scrollTop:0,tooltip:{title:"",show:!1,top:0,left:0},tutorial:{active_slide:1,show:!1},menu_open:!1,nodes_filtered_by_score:!1}},computed:{all_selected:function(){return 20===this.checked_articles.length},botscoreCount:function(){return function(t,e){return Object.values(this.graph.botscores()).filter(function(i){return i.score>=t&&i.score<e}).length}},controls_margin_top:function(){var t=document.getElementById("articles_controls")&&document.getElementById("articles_controls").offsetHeight,e=document.getElementById("article_list")&&document.getElementById("article_list").offsetHeight;try{return this.getOffset("articles").top+e-t<=this.scrollTop+20?e-t+"px":this.scrollTop>this.getOffset("articles").top-20?this.scrollTop-this.getOffset("articles").top+20+"px":0}catch(t){return 0}},embeddedWidgetCode:function(){return'<link rel="stylesheet" href="'+location.origin+("/"!==location.pathname?location.pathname:"")+'/static/css/widget.min.css" /><div class="hoaxy-widget"><div class="hoaxy-widget-leftdiv"><div class="hoaxy-widget-leftdiv-toplogo"><img src="'+location.origin+("/"!==location.pathname?location.pathname:"")+'/static/widget_images/HoaxyLogo.png" /></div><div class="hoaxy-widget-leftdiv-bottominfo">Use Hoaxy to see how this spreads online: <a href="'+location.href+'" target="_blank">'+this.shortenArticleText(this.searched_query_text,100)+'</a></div></div><div class="hoaxy-widget-rightdiv"><img class="hoaxy-widget-rightdiv-imgvis" src="'+this.widgetScreenshotDataUrl+'"/></div></div>'},searchByDependencyTitle:function(){return"Hoaxy"==this.searchBy?"enter any phrase":"enter any phrase or link"}},methods:{logIn:function(){var t=this;this.twitterLogIn().then(function(e){t.twitter_account_info=userData,t.profile.image=userData.profile_image_url_https,t.profile.name="@"+userData.screen_name})},logOut:function(){var t=this;this.twitterLogOut().then(function(e){t.profile.name="",t.profile.image=defaultProfileImage})},checkPOSTData(){},fileUploadHandler:function(t){this.ready_to_visualize=!1;var e=t.target.files[0],i=e.type;i=i.substr(12);var r=e.type;r=r.substr(5);var a=new FileReader,s=this;"json"==i?(s.imported_file_type="json",s.ready_to_visualize=!0,a.onload=function(t){var e=t.target.result;s.imported_data=JSON.parse(e),s.ready_to_visualize=!0}):"csv"==r||"x-csv"==r||"plain"==r||"vnd.ms-excel"==i?(s.imported_file_type="csv",s.ready_to_visualize=!0,a.onload=function(t){var e=t.target.result,i=s.parseCSV(e);s.imported_data=i,s.ready_to_visualize=!0}):(alert("File type should be .csv or .json"),s.ready_to_visualize=!1),a.readAsText(e)},parseCSV:function(t){var e=t.split("\r\n"),i=[],r=e[0].split(",");for(var a of e){var s=a.split(","),o={};for(var n in r)o[r[n]]=s[n];i.push(o)}return i},visualizeImportedData:function(){var t=this;t.spinStart("visualizeImportedData"),setTimeout(function(){t.globalTwitterSearchTimeline=new TwitterSearchTimeline({updateDateRangeCallback:t.updateGraph,graphAnimation:t.graphAnimation}),t.globalTwitterSearchTimeline.chart.interactiveLayer.dispatch.on("elementClick",function(e){t.pauseGraphAnimation(),t.graphAnimation.current_timestamp=Math.floor(e.pointXValue),t.graphAnimation.increment=0,t.graphAnimation.playing=!0,t.graphAnimation.paused=!0,t.unpauseGraphAnimation(),t.pauseGraphAnimation()}),t.timeline=t.globalTwitterSearchTimeline;var e=t.imported_data;"csv"==t.imported_file_type&&e.shift(),t.resetTwitterSearchResults(),t.resetHoaxySearchResults();var i=decodeURI(e[0].original_query),r=String(i).split("&"),a=String(r).split("=");a=String(a).split(",");for(var s in t.query_text=a[1],t.searched_query_text=a[1],t.searchBy=a[5],t.searchedBy=a[5],"Hoaxy"==t.searchBy?(t.hoaxySearchSelected=!0,t.twitterSearchSelected=!1,t.hoaxyEdges.original_query=e[0].original_query):(t.hoaxySearchSelected=!1,t.twitterSearchSelected=!0,t.twitterEdges.original_query=e[0].original_query),e){var o=e[s];o.date_published=o.tweet_created_at,o.pub_date=o.tweet_created_at;var n=new Date(o.pub_date);n instanceof Date&&!isNaN(n)&&(""!=o.from_user_botscore&&t.graph.setBotScore(o.from_user_id,o.from_user_botscore),""!=o.to_user_botscore&&t.graph.setBotScore(o.to_user_id,o.to_user_botscore),"TRUE"==o.is_mention.toString().toUpperCase()&&(o.is_mention=!0),"FALSE"==o.is_mention.toString().toUpperCase()&&(o.is_mention=!1),t.twitterEdges.push(o),t.twitterDates.push(n),t.twitterUserSet.add(o.from_user_id),t.twitterUserSet.add(o.to_user_id))}t.buildTwitterGraph(!0),t.checkIfShouldDisableAnimation(t.twitterEdges),t.spinStop("visualizeImportedData")},250)},selectTop20:function(){var t=this.getSubsetOfArticles(),e=this.all_selected;if(this.checked_articles=[],!e)for(var i=0;i<20&&!(i>=t.length);i+=1)this.checked_articles.push(t[i].url_id)},tutorialNextSlide:function(){this.tutorial.active_slide<5&&(this.tutorial.active_slide+=1)},tutorialPreviousSlide:function(){this.tutorial.active_slide>1&&(this.tutorial.active_slide-=1)},tutorialGotoSlide:function(t){this.tutorial.active_slide=t},tutorialHide:function(){this.tutorial.show=!1},tutorialHideWithCookie:function(){this.tutorial.show=!1,document.cookie="HideHoaxyTutorial=true;max-age=31536000"},hoverTooltip:function(t){var e=t.target,i=this.getOffset(e);this.tooltip.title=e.title,this.tooltip.show=!0,this.tooltip.top=i.bottom,this.tooltip.left=i.left,e.title=""},hideTooltip:function(t){t.target.title=this.tooltip.title,this.tooltip.title="",this.tooltip.show=!1,this.tooltip.top=0,this.tooltip.left=0},filterNodesByScore:function(t,e){this.nodes_filtered_by_score===e+" "+t?(this.graph.filterNodesByScore(),this.nodes_filtered_by_score=!1):(this.graph.filterNodesByScore(e,t),this.nodes_filtered_by_score=e+" "+t)},twitterSearch:function(){this.twitter_result_type="mixed",this.searchBy="Twitter",this.searchPlaceholder="Examples: vaccines, www.wsj.com",this.twitterSearchSelected=!0,this.hoaxySearchSelected=!1},hoaxySearch:function(){this.query_sort="relevant",this.searchBy="Hoaxy",this.searchPlaceholder="Example: vaccines",this.hoaxySearchSelected=!0,this.twitterSearchSelected=!1},initializeHoaxyTimeline:function(){var t=this;this.globalHoaxyTimeline=new HoaxyTimeline({updateDateRangeCallback:this.updateGraph,graphAnimation:this.graphAnimation}),this.globalHoaxyTimeline.chart.interactiveLayer.dispatch.on("elementClick",function(e){t.pauseGraphAnimation(),t.graphAnimation.current_timestamp=Math.floor(e.pointXValue),t.graphAnimation.increment=0,t.graphAnimation.playing=!0,t.graphAnimation.paused=!0,t.unpauseGraphAnimation(),t.pauseGraphAnimation()}),this.timeline=this.globalHoaxyTimeline},initializeTwitterTimeline:function(){var t=this;this.globalTwitterSearchTimeline=new TwitterSearchTimeline({updateDateRangeCallback:this.updateGraph,graphAnimation:this.graphAnimation}),this.globalTwitterSearchTimeline.chart.interactiveLayer.dispatch.on("elementClick",function(e){t.pauseGraphAnimation(),t.graphAnimation.current_timestamp=Math.floor(e.pointXValue),t.graphAnimation.increment=0,t.graphAnimation.playing=!0,t.graphAnimation.paused=!0,t.unpauseGraphAnimation(),t.pauseGraphAnimation()}),this.timeline=this.globalTwitterSearchTimeline},formatTime:function(t){return moment(t).format("MMM D YYYY h:mm a")},stripWwwIfPresent:function(t){return"www."==t.substring(0,4)?t.substring(4):t},prepareAndShowWidgetCode:function(){var t=this.graph.getRenderer();this.widgetScreenshotDataUrl=t.snapshot({format:"jpg",background:"white",labels:!0}),this.showWidgetModal=!0},copyWidgetCodeToClipboard:function(){this.$refs.widgetCodeTextArea.select(),document.execCommand("copy"),this.copiedWidgetText=!0},resetWidgetContent:function(){this.showWidgetModal=!1,this.copiedWidgetText=!1},focusSearchBox:function(){this.search_disabled=!1},formatArticleType:function(t){return"claim"==t?"claims":"fact_checking"==t?"fact checking articles":""},shortenArticleText:function(t,e){return t&&t.length>parseInt(e)?(shortened_text=t.substr(0,parseInt(e)-1)+"...",shortened_text):t},getTopUsaArticles:function(){this.spinStart();var t=window.location.origin+"/news_sources/top-news-usa.json",e=axios.get(t,{dataType:"json"}),i=this;e.then(function(t){for(var e=t.data,r=0;r<3;r++)e[r].shortened_source=i.stripWwwIfPresent(i.attemptToGetUrlHostName(e[r].url)).toUpperCase(),e[r].shortened_headline=i.shortenArticleText(e[r].headline,70),i.top_usa_articles.push(e[r]);i.spinStop()},function(t){console.log("Get Top Articles Request failed: ",t),i.spinStop()})},getPopularArticles:function(){this.spinStart();var t=axios.get(configuration.top_articles_url,{headers:configuration.top_articles_headers,dataType:"json"}),e=this;t.then(function(t){var i=(t=t.data).articles,r=0,a=0;for(var s in i){var o=i[s];if("claim"==o.site_type){if(++r>3)continue;o.shortened_source=e.stripWwwIfPresent(e.attemptToGetUrlHostName(o.canonical_url)).toUpperCase(),o.shortened_headline=e.shortenArticleText(o.title,70),e.top_claim_articles.push(o)}else{if(++a>3)continue;o.shortened_source=e.stripWwwIfPresent(e.attemptToGetUrlHostName(o.canonical_url)).toUpperCase(),o.shortened_headline=e.shortenArticleText(o.title,70),e.top_fact_checking_articles.push(o)}}e.spinStop()},function(t){console.log("Get Articles Request failed: ",t),e.spinStop()})},getSubsetOfArticles:function(){return this.articles.slice(0,this.articles_to_show)},getDateline:function(t){return moment(t).format("MMM D, YYYY")},attemptToGetUrlHostName:function(t){var e=document.createElement("a");return e.href=t,window.location.hostname==e.hostname?"Source Not Available":e.hostname},attemptToGetUrlHostPath:function(t){var e=document.createElement("a");return e.href=t,window.location.hostname==e.hostname?null:e.hostname+e.pathname},getOffset:function(t){if(!t)throw"No element defined in getOffset";"string"==typeof t&&(t=document.getElementById(t));for(var e=t.offsetLeft,i=t.offsetTop,r=t.offsetHeight;t=t.offsetParent;)e+=t.offsetLeft,i+=t.offsetTop;return{left:e,top:i,bottom:i+r}},scrollToElement:function(t){if(document.getElementById(t)){var e=this.getOffset(t).top-0;window.scroll(0,e)}this.loadShareButtons()},directSearchDashboard:function(t,e){this.changeAndFocusSearchQuery(t,e),this.submitForm()},changeAndFocusSearchQuery:function(t,e){"mainstream"==e?(this.searchBy="Twitter",this.twitterSearchSelected=!0,this.hoaxySearchSelected=!1):(this.searchBy="Hoaxy",this.twitterSearchSelected=!1,this.hoaxySearchSelected=!0),this.query_text=t,"import"==this.import_or_search&&(this.import_or_search="search"),this.$refs.searchBox.focus()},changeURLParamsHoaxy:function(){var t="query="+encodeURIComponent(this.query_text)+"&sort="+this.query_sort+"&type="+this.searchBy;return location.hash=t,t},changeURLParamsTwitter:function(){var t="query="+encodeURIComponent(this.query_text)+"&sort="+this.twitter_result_type+"&type="+this.searchBy;return location.hash=t,t},spinStop:function(t,e){var i=this.spin_key_table.indexOf(t);i>=0&&this.spin_key_table.splice(i,1),0!=this.spin_key_table.length&&!0!==e||(this.loading=!1,this.input_disabled=!1,this.search_disabled=!0,clearTimeout(this.spin_timer))},spinStart:function(t){this.spin_key_table.push(t),this.loading=!0,this.input_disabled=!0,this.search_disabled=!0;var e=this;clearTimeout(this.spin_timer),this.spin_timer=setTimeout(function(){e.displayError("The app is taking too long to respond.  Please try again later."),console.debug(e.spin_key_table),e.spin_key_table.length=0,e.spinStop()},9e4)},formatDate:function(t){var e=t.split(" "),i=(moment.monthsShort().indexOf(e[1])+1).toString();1==i.length&&(i="0"+i);var r=e[3].split(":");return e[5]+"-"+i+"-"+e[2]+"T"+r[0]+":"+r[1]+":"+r[2]+"Z"},sortDates:function(t,e){return t>e?1:t<e?-1:0},createTwitterDateBins:function(t){var e=this,i=0,r=0,a=[],s=t[0].getTime(),o=t[t.length-1].getTime(),n=Math.ceil(Math.abs(o-s)/1e3);n<600?(i=n+1,r=1e3):n<36e3?(i=Math.ceil(n/60)+1,r=6e4):n<864e3?(i=Math.ceil(n/3600)+1,r=36e5):(i=Math.ceil(n/86400)+1,r=864e5);for(var c=0;c<=i;c++)a.push(s+c*r);c=0;for(var h=0,l=0;l<t.length;l++){if(t[l].getTime()<=a[c])h+=1;else{for(;t[l].getTime()>a[c];){var u=new Date(a[c]);e.twitterTimeline.claim.timestamp.push(u),e.twitterTimeline.claim.volume.push(h),e.twitterTimeline.fact_checking.timestamp.push(u),e.twitterTimeline.fact_checking.volume.push(0),c+=1}h+=1}if(l==t.length-1){u=new Date(a[c]);e.twitterTimeline.claim.timestamp.push(u),e.twitterTimeline.claim.volume.push(h),e.twitterTimeline.fact_checking.timestamp.push(u),e.twitterTimeline.fact_checking.volume.push(0)}}},resetTwitterSearchResults:function(){this.animationAvailable=!0,this.twitterEdges=[],this.twitterTimeline={claim:{timestamp:[],volume:[]},fact_checking:{timestamp:[],volume:[]}},this.twitterUserSet=new Set,this.twitterDates=[]},resetHoaxySearchResults:function(){this.animationAvailable=!0,this.hoaxyEdges=[]},buildTwitterEdgesTimeline:function(t){function e(){this.canonical_url="",this.date_published="",this.domain="",this.from_user_botscore="",this.from_user_id="",this.from_user_screen_name="",this.id="",this.is_mention=!1,this.original_query="",this.pub_date="",this.site_domain="",this.site_type="claim",this.title="",this.to_user_botscore="",this.to_user_id="",this.to_user_screen_name="",this.tweet_created_at="",this.tweet_id="",this.tweet_type="",this.tweet_url="",this.url_id="",this.url_raw=""}this.spinStart("buildGraph"),this.spinner_notices.timeline="Building Graph and Timeline...";var i=this,r=t.length,a=!1,s=!1;function o(e){try{n.tweet_id=t[r].id_str}catch(t){n.tweet_id=""}var a=i.formatDate(t[r].created_at);i.twitterDates.push(new Date(a)),n.date_published=a,n.pub_date=a,n.tweet_created_at=a,n.tweet_type=e,i.twitterEdges.push(n)}for(;r>0;){if(a=!1,s=!1,t[r-=1].quoted_status){var n=new e;try{n.from_user_id=t[r].quoted_status.user.id_str,i.twitterUserSet.add(n.from_user_id),a=!0}catch(t){n.from_user_id=""}try{n.from_user_screen_name=t[r].quoted_status.user.screen_name,a=!0}catch(t){n.from_user_screen_name=""}try{n.to_user_id=t[r].user.id_str,i.twitterUserSet.add(n.to_user_id),s=!0}catch(t){n.to_user_id=""}try{n.to_user_screen_name=t[r].user.screen_name,s=!0}catch(t){n.to_user_screen_name=""}a&&s&&o("quote")}if(a=!1,s=!1,t[r].retweeted_status){n=new e;try{n.from_user_id=t[r].retweeted_status.user.id_str,i.twitterUserSet.add(n.from_user_id),a=!0}catch(t){n.from_user_id=""}try{n.from_user_screen_name=t[r].retweeted_status.user.screen_name,a=!0}catch(t){n.from_user_screen_name=""}try{n.to_user_id=t[r].user.id_str,i.twitterUserSet.add(n.to_user_id),s=!0}catch(t){n.to_user_id=""}try{n.to_user_screen_name=t[r].user.screen_name,s=!0}catch(t){n.to_user_screen_name=""}a&&s&&o("retweet")}else if(t[r].entities.user_mentions.length>0){a=!1,s=!1;for(var c=0;c<t[r].entities.user_mentions.length;c++){(n=new e).is_mention=!0;try{n.from_user_id=t[r].user.id_str,i.twitterUserSet.add(n.from_user_id),a=!0}catch(t){n.from_user_id=""}try{n.from_user_screen_name=t[r].user.screen_name,a=!0}catch(t){n.from_user_screen_name=""}try{n.to_user_id=t[r].entities.user_mentions[c].id_str,i.twitterUserSet.add(n.to_user_id),s=!0}catch(t){n.to_user_id=""}try{n.to_user_screen_name=t[r].entities.user_mentions[c].screen_name,s=!0}catch(t){n.to_user_screen_name=""}a&&s&&o("mention")}}}i.spinStop("buildGraph")},buildTwitterGraph:function(t){var e=this;0==e.twitterEdges.length?(e.show_zoom_buttons=!1,e.failed_to_get_network=!0,e.spinner_notices.graph="",e.show_graphs=!0,Vue.nextTick(function(){e.graph.updateEdges(e.twitterEdges),e.updateGraph(),e.graph.score_stats.reset(),t||(e.graph.resetBotscores(),e.graph.setLang(e.lang),e.graph.getBotCacheScores()),e.spinStop("generateNetwork"),e.scrollToElement("secondary_form")}),e.spinStop("buildGraph")):(e.graph.updateEdges([]),e.twitterDates.sort(e.sortDates),e.createTwitterDateBins(e.twitterDates),e.spinner_notices.timeline="",e.spinStart("updateTimeline"),e.show_graphs=!0,Vue.nextTick(function(){e.timeline.update(e.twitterTimeline),e.spinStop("updateTimeline"),e.scrollToElement("secondary_form"),e.timeline.redraw()}),this.spinStart("getNetwork"),this.spinner_notices.graph="Fetching graph...",this.timeline.removeUpdateDateRangeCallback(),this.failed_to_get_network=!1,e.spinStop("getNetwork"),e.spinner_notices.graph="Drawing Graph...",e.spinStart("generateNetwork"),e.show_graphs=!0,Vue.nextTick(function(){e.graph.updateEdges(e.twitterEdges),e.updateGraph(),e.graph.score_stats.reset(),t||(e.graph.resetBotscores(),e.graph.setLang(e.lang),e.graph.getBotCacheScores()),e.spinStop("generateNetwork"),e.scrollToElement("secondary_form")}),e.spinStop("buildGraph"))},getTwitterSearchResults:function(t){this.spinStart("getTwitterSearchResults"),this.spinner_notices.timeline="Searching Twitter...";var e=this,i=decodeURIComponent(t),r="",a=10,s=this.lang;!function t(){tweetsReponse=e.twitter.getTweets(i,s,r,e.twitter_result_type),tweetsReponse.then(function(s){a-=1,s.search_metadata.next_results?r=s.statuses[s.statuses.length-1].id_str:i="",e.buildTwitterEdgesTimeline(s.statuses),e.twitterUserSet.size<1e3&&""!=i&&a>0?t():(e.spinStop("getTwitterSearchResults"),e.buildTwitterGraph(),e.checkIfShouldDisableAnimation(e.twitterEdges))},function(t){e.spinStop("getTwitterSearchResults"),429==t.error.status?e.displayError("Twitter rate limit reached. Try again in 15 minutes."):e.toggleModal("authenticate",!0)}).catch(function(t){console.debug("ERROR CAUGHT"),e.spinStop("getTwitterSearchResults"),e.displayError("Twitter Search Pagination Error: "+t)})}()},getArticles:function(t){this.spinStart("getArticles"),this.spinner_notices.articles="Fetching articles...";var e=axios.get(configuration.articles_url,{headers:configuration.articles_headers,params:{query:this.query_text,sort_by:this.query_sort},responseType:"json"}),i=this;return e.then(function(t){i.spinner_notices.articles="";var e=t.data,r=e;if(!e.articles||!e.articles.length)return i.displayError("Your query did not return any results."),i.spinStop("getArticles"),!1;r.urls=e.articles.map(function(t){return y=t,y.site_domain=t.domain,y.url_id=t.id,y.pub_date=t.publish_date,y.url_raw=t.canonical_url,y}),i.articles=r.urls,i.articles_to_show=max_articles,i.checked_articles.push(i.articles[0].url_id),i.getTimeline(i.checked_articles),i.getNetwork(i.checked_articles),i.spinStop("getArticles")},function(t){i.spinner_notices.articles="",i.displayError("Get URLs Request failed: "+t),i.spinStop("getArticles")}),e},getTimeline:function(t){this.spinStart("getTimeline"),this.spinner_notices.timeline="Fetching timeline...";var e=axios.get(configuration.timeline_url,{headers:configuration.timeline_headers,params:{resolution:"D",ids:"["+t.toString()+"]"},responseType:"json"}),i=this;return e.then(function(t){i.spinner_notices.timeline="";var e=t.data;i.spinStart("updateTimeline"),i.show_graphs=!0,i.show_articles=!0,Vue.nextTick(function(){i.timeline.update(e.timeline),i.spinStop("updateTimeline"),i.scrollToElement("secondary_form"),i.timeline.redraw()}),i.spinStop("getTimeline")},function(t){i.spinner_notices.timeline="",i.displayError("Get TimeLine Request failed: "+t),i.spinStop("getTimeline")}),e},getNetwork:function(t){this.spinStart("getNetwork"),this.spinner_notices.graph="Fetching graph...",this.timeline.removeUpdateDateRangeCallback(),this.failed_to_get_network=!1;var e=axios.get(configuration.network_url,{headers:configuration.network_headers,params:{include_user_mentions:"true",ids:"["+t.toString()+"]"},responseType:"json"}),i=this;return e.then(function(t){i.spinStop("getNetwork"),i.spinner_notices.graph="Drawing Graph...";var e,r=t.data;r.error?(i.show_zoom_buttons=!1,i.failed_to_get_network=!0,e=[],i.spinner_notices.graph=""):i.spinStart("generateNetwork"),i.show_graphs=!0,i.show_articles=!0,Vue.nextTick(function(){e=r.edges.map(function(t){y=t,y.site_domain=t.domain,y.pub_date=t.publish_date,y.url_raw=t.canonical_url;var e=window.location.hash.toString();return y.original_query=e.substr(1),y}),i.hoaxyEdges=e,i.graph.updateEdges(e),i.updateGraph(),i.graph.score_stats.reset(),i.graph.resetBotscores(),i.graph.setLang(i.lang),i.graph.getBotCacheScores(),i.checkIfShouldDisableAnimation(i.hoaxyEdges),i.scrollToElement("secondary_form")})},function(t){var e="";e=t.response&&t.response.statusText?t.response.statusText:"Unknown error, likely a problem connecting to API server.",i.displayError("Get Graph Request failed: "+e),i.spinStop("getNetwork"),i.spinner_notices.graph=""}),e},submitFeedbackForm:function(){this.feedback_form.display=!1;var t=this;t.twitter_account_info.id?t.sendFeedbackData():t.twitterLogIn().then(function(){t.sendFeedbackData()},function(e){console.warn(e),t.spinStop(null,!0)})},sendFeedbackData:function(){var t={source_user_id:this.twitter_account_info.id,target_user_id:this.node_modal_content.user_id,target_screen_name:this.node_modal_content.screenName,feedback_label:this.feedback_form.type,feedback_text:this.feedback_form.comment,target_profile:null,target_timeline_tweets:null,target_mention_tweets:null,time_stamp:new Date,botscore_computed_time:this.node_modal_content.timestamp,reported_botscore:this.node_modal_content.botscore,source_screen_name:this.twitter_account_info.screen_name};axios({method:"POST",url:configuration.feedback_url,data:t}).then(function(t){console.debug(t.data)},function(t){console.debug(t)});this.feedback_form.type="",this.feedback_form.comment="",console.debug(t)},resizeGraphs:function(t){this.graph_column_size=t;var e=this;Vue.nextTick(function(){e.timeline.redraw(),e.graph.redraw()})},shrinkGraph:function(){this.graph_column_size+=3,this.resizeGraphs()},shrinkTimeline:function(){this.graph_column_size-=3,this.resizeGraphs()},filterGraph:function(){var t=new Date(2017,5,15).getTime();this.graph.filter(t)},startGraphAnimation:function(){this.graph.startAnimation()},stopGraphAnimation:function(){this.graph.stopAnimation(),this.graphAnimation.current_timestamp=0},pauseGraphAnimation:function(){this.graph.pauseAnimation()},unpauseGraphAnimation:function(){this.graph.unpauseAnimation()},twitterLogIn:function(){var t=this.twitter.verifyMe(),e=this;return t.then(function(t){e.twitter_account_info=t,e.profile.image=t.profile_image_url_https,e.profile.name="@"+t.screen_name},function(t){e.twitter_account_info={},console.warn("error: ",t)}),t},getMoreBotScores:function(){this.twitter_account_info.id?this.graph.getNewScores():this.twitterLogIn().then(this.graph.getNewScores,function(t){console.warn(t),v.spinStop(null,!0)})},getSingleBotScore:function(t){var e=this;this.getting_bot_scores.running=!0,new Promise(function(i,r){e.twitter_account_info.id?e.graph.updateUserBotScore({user_id:t}).then(i,r):e.twitterLogIn().then(function(){e.graph.updateUserBotScore({user_id:t}).then(i,r)},function(t){console.warn(t),r(t)})}).then(function(t){if("Error: rate limit reached"===t)e.twitterRateLimitReachedObj.isReached=!0,e.getting_bot_scores.running=!1;else{e.twitterRateLimitReachedObj.isReached=!1,e.getting_bot_scores.running=!1;try{var i=0;i="en"==e.lang||"en-gb"==e.lang?t.data.scores.english:t.data.scores.universal,e.node_modal_content.botscore=Math.floor(100*i),e.node_modal_content.botcolor=e.graph.getNodeColor(i),e.node_modal_content.timestamp=new Date}catch(t){console.warn(t),e.node_modal_content.botscore=-1,e.node_modal_content.botcolor=e.graph.getNodeColor(-1)}}},function(){e.getting_bot_scores.running=!1,e.node_modal_content.botscore=-1,e.node_modal_content.botcolor=e.graph.getNodeColor(-1)})},twitterLogOut:function(){var t=this.twitter.logOut();return this.twitter_account_info={},this.profile.name="",this.profile.image=defaultProfileImage,t},buildJSONContent:function(){var t={};this.hoaxyEdges.length>0?t=this.hoaxyEdges:this.twitterEdges.length>0&&(t=this.twitterEdges);var e=t.length,i=window.location.hash.toString();let r=this.graph.botscores();for(var a="",s=[],o=0;o<e;o++){let e=JSON.parse(JSON.stringify(t[o]));e.original_query=i.substr(1),e.from_user_botscore="",e.to_user_botscore="",r[t[o].from_user_id]&&r[t[o].from_user_id].score&&(e.from_user_botscore=r[t[o].from_user_id].score),r[t[o].to_user_id]&&r[t[o].to_user_id].score&&(e.to_user_botscore=r[t[o].to_user_id].score),e.tweet_url="",t[o].from_user_screen_name&&t[o].tweet_id&&(e.tweet_url="https://twitter.com/"+String(t[o].from_user_screen_name)+"/status/"+String(t[o].tweet_id)),s.push(e)}return a+=JSON.stringify(s)},downloadJSON:function(t){var e=new Date,i=e.getFullYear()+"y."+(e.getMonth()+1)+"m."+e.getDate()+"d_";i+=e.getHours()+"h."+e.getMinutes()+"m."+e.getSeconds()+"s_";var r="hoaxy_visualization_"+(i+=e.toTimeString().substr(9))+".json";t="data:text/json;charset=iso-639,"+t;var a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",r),document.body.appendChild(a),a.click()},downloadCSV:function(t){var e=new Date,i=e.getFullYear()+"y."+(e.getMonth()+1)+"m."+e.getDate()+"d_";i+=e.getHours()+"h."+e.getMinutes()+"m."+e.getSeconds()+"s_";var r="hoaxy_visualization_"+(i+=e.toTimeString().substr(9))+".csv",a=JSON.parse(t),s=Papa.unparse(a,this.papa_unparse_config);s="data:text/csv;charset=iso-639,"+s,s=encodeURI(s);var o=document.createElement("a");o.setAttribute("href",s),o.setAttribute("download",r),document.body.appendChild(o),o.click()},submitForm:function(t){if(this.stopGraphAnimation(),this.resetTwitterSearchResults(),this.resetHoaxySearchResults(),"Hoaxy"==this.searchBy){if(this.show_articles=!1,this.show_graphs=!1,this.checked_articles=[],!this.query_text)return this.displayError("You must input a claim."),this.spinStop(!0),!1;var e=this;this.globalHoaxyTimeline=new HoaxyTimeline({updateDateRangeCallback:this.updateGraph,graphAnimation:this.graphAnimation}),this.globalHoaxyTimeline.chart.interactiveLayer.dispatch.on("elementClick",function(t){e.pauseGraphAnimation(),e.graphAnimation.current_timestamp=Math.floor(t.pointXValue),e.graphAnimation.increment=0,e.graphAnimation.playing=!0,e.graphAnimation.paused=!0,e.unpauseGraphAnimation(),e.pauseGraphAnimation()}),this.timeline=this.globalHoaxyTimeline,this.changeURLParamsHoaxy(),this.getArticles(t),this.spinStop()}else if("Twitter"==this.searchBy){if(this.show_articles=!1,this.show_graphs=!1,this.checked_articles=[],!this.query_text)return this.displayError("You must input a valid search query."),this.spinStop(!0),!1;e=this;this.globalTwitterSearchTimeline=new TwitterSearchTimeline({updateDateRangeCallback:this.updateGraph,graphAnimation:this.graphAnimation}),this.globalTwitterSearchTimeline.chart.interactiveLayer.dispatch.on("elementClick",function(t){e.pauseGraphAnimation(),e.graphAnimation.current_timestamp=Math.floor(t.pointXValue),e.graphAnimation.increment=0,e.graphAnimation.playing=!0,e.graphAnimation.paused=!0,e.unpauseGraphAnimation(),e.pauseGraphAnimation()}),this.timeline=this.globalTwitterSearchTimeline,this.changeURLParamsTwitter();var i=this.attemptToGetUrlHostPath(this.query_text);null!=i?this.getTwitterSearchResults(i):this.getTwitterSearchResults(encodeURIComponent(this.query_text)),this.spinStop()}this.searched_query_text=this.query_text,this.searchedBy=this.searchBy},checkIfShouldDisableAnimation:function(t){if(t.length>0){for(var e=!1,i=t[0].tweet_created_at,r=0;r<t.length;r++){if(t[r].tweet_created_at!=i){e=!0;break}}this.animationAvailable=e}},visualizeSelectedArticles:function(){this.show_graphs=!1,this.show_full_articles_list=!1,this.$nextTick(function(){if(this.scrollToElement("article_list"),this.checked_articles.length<=0)return this.displayError("Select at least one article to visualize."),this.spinStop(!0),!1;this.graph.updateEdges([]),this.getTimeline(this.checked_articles),this.getNetwork(this.checked_articles),this.spinStop()})},toggleEdgeModal:function(t){this.toggleModal("edge",t)},toggleNodeModal:function(t){this.toggleModal("node",t),this.feedback_form.display=!1},displayError:function(t){this.error_message=t,this.toggleModal("error",!0)},toggleErrorModal:function(t){this.toggleModal("error",t)},toggleTutorialModal:function(t){this.toggleModal("tutorial",t)},toggleModal:function(t,e){this.graph.redraw();var i="show_"+t+"_modal",r=this;this[i]&&!0!==e?(this.modal_opacity=!1,document.getElementsByTagName("body")[0].style.overflowY="",setTimeout(function(){r[i]=!1},100)):(this[i]=!0,document.getElementsByTagName("body")[0].style.overflowY="hidden",setTimeout(function(){r.modal_opacity=!0},1))},loadMore:function(){this.articles_to_show<this.articles.length?this.articles_to_show+=max_articles:this.articles_to_show=max_articles},zoomInGraph:function(){this.graph.zoomIn()},zoomOutGraph:function(){this.graph.zoomOut()},updateGraph:function(t,e){if(this.graph_column_size=3,this.failed_to_get_network)return!1;this.graph.updateGraph(t,e),this.show_zoom_buttons=!0,this.scrollToElement("secondary_form")},loadShareButtons:function(){try{twttr.widgets.load()}catch(t){console.warn("error loading twttr widgets",t)}try{FB.XFBML.parse()}catch(t){console.warn("error loading facbook widgets",t)}}},watch:{query_sort:function(){this.$refs.searchBox.focus()},twitter_result_type:function(){this.$refs.searchBox.focus()},show_graphs:function(){},"graphAnimation.current_timestamp":function(){this.timeline.updateTimestamp()},searchBy:function(){"Hoaxy"==this.searchBy&&(this.lang=defaultHoaxyLang)}},beforeMount:function(){this.getPopularArticles(),this.getTopUsaArticles();try{this.imported_data=JSON.parse(document.getElementById("post_data").innerHTML),this.imported_data=JSON.parse(this.imported_data)}catch(t){console.warn(t),""!=this.imported_data&&(location.href="https://hoaxy.iuni.iu.edu/")}},mounted:function(){this.mounted=!0,this.show_articles=!1,this.show_graphs=!1,""!=this.imported_data&&this.visualizeImportedData();var t,e=this,i=(t=0,setInterval(function(){e.loading&&(++t<4?e.spinner_rotate=0*(e.spinner_state=t):t<=12?e.spinner_rotate=22.5*(t-4):t=0)},100),location.hash.substring(1,location.hash.length).split("&")),r="";for(var a in i){var s=i[a].split("="),o=s[0],n=s[1];"query"==o&&(this.query_text=decodeURIComponent(n)),"sort"==o&&(r=n),"type"==o&&(this.searchBy=n,"Hoaxy"==this.searchBy?(this.hoaxySearchSelected=!0,this.twitterSearchSelected=!1,this.query_sort=r):"Twitter"==this.searchBy&&(this.twitterSearchSelected=!0,this.hoaxySearchSelected=!1,this.twitter_result_type=r))}(this.twitter=new Twitter(configuration.twitter_key),this.me=this.twitter.me(),this.graph=new HoaxyGraph({spinStart:this.spinStart,spinStop:this.spinStop,toggle_edge_modal:this.toggleEdgeModal,toggle_node_modal:this.toggleNodeModal,node_modal_content:this.node_modal_content,edge_modal_content:this.edge_modal_content,getting_bot_scores:this.getting_bot_scores,spinner_notices:this.spinner_notices,twitter:this.twitter,graphAnimation:this.graphAnimation,twitterRateLimitReached:this.twitterRateLimitReachedObj}),this.spinStop("initialLoad"),this.query_text)||-1==document.cookie.split("; ").indexOf("HideHoaxyTutorial=true")&&(this.tutorial.show=!0);this.query_text&&this.submitForm(!0);var c=0;window.addEventListener("scroll",function(){clearTimeout(c),c=0,c=setTimeout(function(){e.scrollTop=window.pageYOffset},50)})}});
